node {
  stage 'build app'
  openshiftCreateResource(jsonyaml: ''' {"apiVersion":"v1","kind":"ImageStream","metadata":{"annotations":{"openshift.io/generated-by":"OpenShiftWebConsole"},"creationTimestamp":"2017-06-23T19:00:34Z","generation":1,"labels":{"app":"welcome"},"name":"welcome"},"spec":{},"status":{}}  ''', namespace: 'myproject', verbose: 'false') 
  openshiftCreateResource(jsonyaml:  ''' {"apiVersion":"v1","kind":"BuildConfig","metadata":{"annotations":{"openshift.io/generated-by":"OpenShiftWebConsole"},"labels":{"app":"welcome"},"name":"welcome"},"spec":{"output":{"to":{"kind":"ImageStreamTag","name":"welcome:latest"}},"postCommit":{},"resources":{},"runPolicy":"Serial","source":{"git":{"ref":"master","uri":"https://github.com/samueltauil/nodejs-welcome.git"},"type":"Git"},"strategy":{"sourceStrategy":{"from":{"kind":"ImageStreamTag","name":"nodejs:4","namespace":"openshift"}},"type":"Source"},"triggers":[{"generic":{"secret":"5a0bf222b01870cb"},"type":"Generic"},{"github":{"secret":"ca175e2f1c266f00"},"type":"GitHub"},{"imageChange":{},"type":"ImageChange"},{"type":"ConfigChange"}]},"status":{}}  ''', namespace: 'myproject', verbose: 'false' )
  openshiftBuild(namespace: 'myproject', buildConfig: 'welcome', showBuildLogs: 'true')
  openshiftCreateResource(jsonyaml: ''' {"apiVersion":"v1","kind":"DeploymentConfig","metadata":{"annotations":{"openshift.io/generated-by":"OpenShiftWebConsole"},"labels":{"app":"welcome"},"name":"welcome"},"spec":{"replicas":1,"selector":{"deploymentconfig":"welcome"},"strategy":{"activeDeadlineSeconds":21600,"resources":{},"rollingParams":{"intervalSeconds":1,"maxSurge":"25%","maxUnavailable":"25%","timeoutSeconds":600,"updatePeriodSeconds":1},"type":"Rolling"},"template":{"metadata":{"creationTimestamp":null,"labels":{"app":"welcome","deploymentconfig":"welcome"}},"spec":{"containers":[{"image":"welcome:latest","imagePullPolicy":"Always","name":"welcome","ports":[{"containerPort":8080,"protocol":"TCP"}],"resources":{},"terminationMessagePath":"/dev/termination-log"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","securityContext":{},"terminationGracePeriodSeconds":30}},"test":false,"triggers":[{"imageChangeParams":{"automatic":true,"containerNames":["welcome"],"from":{"kind":"ImageStreamTag","name":"welcome:latest","namespace":"myproject"},"lastTriggeredImage":"null"},"type":"ImageChange"},{"type":"ConfigChange"}]},"status":{}}  ''', namespace: "myproject", verbose: "false") 
  stage 'execute image scan'
  stage 'deploy app'
  openshiftDeploy(namespace: 'myproject', deploymentConfig: 'welcome')
}
